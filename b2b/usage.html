<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>사용량 리포트 - 무비서 B2B Console</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      :root {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-card: #1e293b;
        --bg-hover: #334155;
        --accent: #2a4dc4;
        --accent-light: #3b5fd9;
        --accent-dark: #1e3a8a;
        --text-primary: #f8fafc;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --border: #334155;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
      }
      body { font-family: "Noto Sans KR", sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
      .layout { display: flex; min-height: 100vh; }
      .sidebar { width: 260px; background: var(--bg-secondary); border-right: 1px solid var(--border); padding: 24px 0; position: fixed; height: 100vh; overflow-y: auto; }
      .sidebar-logo { padding: 0 24px 24px; border-bottom: 1px solid var(--border); margin-bottom: 24px; }
      .sidebar-logo h1 { font-size: 20px; font-weight: 700; }
      .sidebar-logo h1 span { color: var(--accent); }
      .sidebar-logo p { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
      .sidebar-nav { list-style: none; }
      .sidebar-nav a { display: flex; align-items: center; gap: 12px; padding: 12px 24px; color: var(--text-secondary); text-decoration: none; font-size: 14px; transition: all 0.2s; }
      .sidebar-nav a:hover { background: var(--bg-hover); color: var(--text-primary); }
      .sidebar-nav a.active { background: rgba(42, 77, 196, 0.1); color: var(--accent); border-right: 3px solid var(--accent); }
      .sidebar-nav .icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }
      .sidebar-section { padding: 16px 24px 8px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
      .main { flex: 1; margin-left: 260px; }
      .header { background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; }
      .header h2 { font-size: 18px; font-weight: 600; }
      .header-actions { display: flex; gap: 12px; }
      .content { padding: 32px; }
      .period-selector { display: flex; gap: 8px; background: var(--bg-primary); padding: 4px; border-radius: 8px; border: 1px solid var(--border); }
      .period-btn { padding: 8px 16px; font-size: 13px; font-family: inherit; background: transparent; border: none; color: var(--text-secondary); border-radius: 6px; cursor: pointer; transition: all 0.2s; }
      .period-btn:hover { color: var(--text-primary); }
      .period-btn.active { background: var(--accent); color: white; }
      .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px; }
      .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
      .stat-card .label { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
      .stat-card .value { font-size: 28px; font-weight: 700; }
      .stat-card .sub { font-size: 12px; color: var(--text-muted); margin-top: 8px; }
      .chart-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
      .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
      .chart-header h3 { font-size: 16px; font-weight: 600; }
      .chart-container { height: 250px; position: relative; }
      .chart-canvas { width: 100%; height: 100%; }
      .chart-labels { display: flex; justify-content: space-between; margin-top: 12px; padding: 0 40px; }
      .chart-labels span { font-size: 11px; color: var(--text-muted); }
      .progress-container { margin-top: 24px; padding: 20px; background: var(--bg-primary); border-radius: 8px; }
      .progress-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; }
      .progress-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
      .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--success)); border-radius: 4px; transition: width 1.5s ease-out; }
      .progress-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: var(--text-muted); }
      .usage-table { width: 100%; border-collapse: collapse; }
      .usage-table th, .usage-table td { text-align: left; padding: 14px 16px; border-bottom: 1px solid var(--border); }
      .usage-table th { font-size: 12px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
      .usage-table td { font-size: 14px; }
      .usage-table tr:last-child td { border-bottom: none; }
      .usage-table tr:hover td { background: rgba(255, 255, 255, 0.02); }
      .endpoint-badge { font-family: "JetBrains Mono", monospace; font-size: 12px; background: var(--bg-primary); padding: 4px 8px; border-radius: 4px; }
      .trend-up { color: var(--success); }
      .trend-down { color: var(--error); }
      @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
      @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } .stats-grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="sidebar-logo"><h1>무비서 <span>B2B</span></h1><p>Console</p></div>
        <nav>
          <ul class="sidebar-nav">
            <li><a href="dashboard.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></span>대시보드</a></li>
            <li><a href="api-keys.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg></span>API Key 관리</a></li>
            <li><a href="usage.html" class="active"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg></span>사용량 리포트</a></li>
            <li><a href="playground.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg></span>API Playground</a></li>
          </ul>
          <div class="sidebar-section">설정</div>
          <ul class="sidebar-nav">
            <li><a href="#"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg></span>계정 설정</a></li>
            <li><a href="#"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg></span>API 문서</a></li>
            <li><a href="#" id="logoutBtn"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></span>로그아웃</a></li>
          </ul>
        </nav>
      </aside>

      <main class="main">
        <header class="header">
          <h2>사용량 리포트</h2>
          <div class="header-actions">
            <div class="period-selector">
              <button class="period-btn" onclick="setPeriod(this, '7d')">7일</button>
              <button class="period-btn active" onclick="setPeriod(this, '30d')">30일</button>
              <button class="period-btn" onclick="setPeriod(this, '90d')">90일</button>
            </div>
          </div>
        </header>

        <div class="content">
          <div class="stats-grid">
            <div class="stat-card"><div class="label">총 API 호출</div><div class="value" id="totalCalls">0</div><div class="sub">이번 달 기준</div></div>
            <div class="stat-card"><div class="label">일 평균 호출</div><div class="value" id="avgCalls">0</div><div class="sub">최근 30일</div></div>
            <div class="stat-card"><div class="label">평균 응답 시간</div><div class="value"><span id="avgTime">0</span><span style="font-size: 14px; color: var(--text-muted);">ms</span></div><div class="sub">p95: 142ms</div></div>
            <div class="stat-card"><div class="label">성공률</div><div class="value" style="color: var(--success);" id="successRate">0%</div><div class="sub">오류: 0.3%</div></div>
          </div>

          <div class="chart-card">
            <div class="chart-header"><h3>일별 API 호출량</h3></div>
            <div class="chart-container"><canvas id="chartCanvas" class="chart-canvas"></canvas></div>
            <div class="chart-labels" id="chartLabels"></div>
            <div class="progress-container">
              <div class="progress-header"><span>이번 달 사용량</span><span><strong id="usedCount">0</strong> / 50,000</span></div>
              <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%;"></div></div>
              <div class="progress-labels"><span id="usedPercent">0%</span> 사용<span id="remainCount">50,000</span> 남음</div>
            </div>
          </div>

          <div class="chart-card">
            <div class="chart-header"><h3>엔드포인트별 사용량</h3></div>
            <table class="usage-table">
              <thead><tr><th>엔드포인트</th><th>호출 수</th><th>성공률</th><th>평균 응답</th><th>추세</th></tr></thead>
              <tbody>
                <tr><td><code class="endpoint-badge">POST /api/b2b/recommend</code></td><td>38,456</td><td>99.8%</td><td>87ms</td><td class="trend-up">+15%</td></tr>
                <tr><td><code class="endpoint-badge">GET /api/b2b/movies/:id</code></td><td>5,892</td><td>99.9%</td><td>23ms</td><td class="trend-up">+8%</td></tr>
                <tr><td><code class="endpoint-badge">GET /api/b2b/genres</code></td><td>883</td><td>100%</td><td>12ms</td><td class="trend-down">-3%</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <script>
      const user = JSON.parse(localStorage.getItem('b2b_user'));
      if (!user) window.location.href = 'login.html';

      // Animate counters
      function animateCounter(id, target, suffix = '', duration = 1500) {
        const el = document.getElementById(id);
        const startTime = performance.now();
        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          const current = Math.floor(target * eased);
          el.textContent = current.toLocaleString() + suffix;
          if (progress < 1) requestAnimationFrame(update);
        }
        requestAnimationFrame(update);
      }

      setTimeout(() => {
        animateCounter('totalCalls', 45231);
        animateCounter('avgCalls', 1507);
        animateCounter('avgTime', 84);
        animateCounter('successRate', 99.7, '%');
        animateCounter('usedCount', 45231);
        animateCounter('remainCount', 4769);
        animateCounter('usedPercent', 90.4, '%');
        setTimeout(() => {
          document.getElementById('progressFill').style.width = '90.4%';
        }, 300);
      }, 300);

      // Draw animated chart
      function drawChart() {
        const canvas = document.getElementById('chartCanvas');
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        canvas.width = canvas.offsetWidth * dpr;
        canvas.height = canvas.offsetHeight * dpr;
        ctx.scale(dpr, dpr);

        const width = canvas.offsetWidth;
        const height = canvas.offsetHeight;
        const data = [1234, 1567, 890, 2100, 1800, 1400, 1507, 1890, 2200, 1650, 1234, 1567, 890, 2100];
        const labels = ['1일', '3일', '5일', '7일', '9일', '11일', '13일', '15일', '17일', '19일', '21일', '23일', '25일', '오늘'];
        const maxValue = Math.max(...data) * 1.2;
        const barWidth = (width - 80) / data.length;
        const gap = 6;

        document.getElementById('chartLabels').innerHTML = labels.map(l => `<span>${l}</span>`).join('');

        let animationProgress = 0;
        function animate() {
          ctx.clearRect(0, 0, width, height);
          ctx.strokeStyle = '#334155';
          ctx.lineWidth = 1;
          for (let i = 0; i <= 4; i++) {
            const y = height - (height * i / 4) - 20;
            ctx.beginPath();
            ctx.moveTo(40, y);
            ctx.lineTo(width - 20, y);
            ctx.stroke();
          }

          data.forEach((value, index) => {
            const barHeight = (value / maxValue) * (height - 40) * animationProgress;
            const x = 45 + index * barWidth;
            const y = height - barHeight - 20;
            const gradient = ctx.createLinearGradient(x, y, x, height - 20);
            gradient.addColorStop(0, '#3b5fd9');
            gradient.addColorStop(1, 'rgba(42, 77, 196, 0.3)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(x + gap/2, y, barWidth - gap, barHeight, [3, 3, 0, 0]);
            ctx.fill();
          });

          if (animationProgress < 1) {
            animationProgress += 0.025;
            requestAnimationFrame(animate);
          }
        }
        setTimeout(animate, 400);
      }

      drawChart();
      window.addEventListener('resize', drawChart);

      function setPeriod(btn, period) {
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      }

      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('b2b_user');
        window.location.href = 'login.html';
      });
    </script>
  </body>
</html>
